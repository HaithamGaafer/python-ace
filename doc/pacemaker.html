<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>pacemaker</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="pandoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">pacemaker</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#installation"><span class="toc-section-number">1</span> Installation</a></li>
<li><a href="#quick-start"><span class="toc-section-number">2</span> Quick start</a></li>
<li><a href="#pacemaker-workflow"><span class="toc-section-number">3</span> <code>pacemaker</code> workflow</a></li>
<li><a href="#input-file"><span class="toc-section-number">4</span> Input file</a></li>
<li><a href="#pacemaker-command-line-interface"><span class="toc-section-number">5</span> <code>pacemaker</code> command line interface</a></li>
<li><a href="#utilities"><span class="toc-section-number">6</span> Utilities</a></li>
<li><a href="#frequently-asked-questions-faq"><span class="toc-section-number">7</span> Frequently asked questions (FAQ)</a></li>
</ul>
</nav>
<p><code>pacemaker</code> is a tool for fitting of interatomic potentials in a general nonlinear Atomic Cluster Expansion (ACE) form.</p>
<h1 data-number="1" id="installation"><span class="header-section-number">1</span> Installation</h1>
<h2 data-number="1.1" id="optional-creating-a-conda-environment"><span class="header-section-number">1.1</span> (optional) Creating a conda environment</h2>
<p>It is common practice creating a separate <code>conda environment</code> to avoid dependencies mixing. You can create the new environment named <code>ace</code> with minimal amount of required packages with the following command:</p>
<pre><code>conda env create -n ace python&lt;3.9</code></pre>
<p>Then, activate the environment with <code>source activate ace</code> or <code>conda activate ace</code>. To deactivate the environment, use <code>deactivate</code> command</p>
<h2 data-number="1.2" id="installation-of-tensorpotential"><span class="header-section-number">1.2</span> Installation of <code>tensorpotential</code></h2>
<p><code>tensorpotential</code> allows for the GPU accelerated optimization of the ACE potential using <a href="https://www.tensorflow.org/">TensorFlow</a>. However, it is recommended to use it even if you don’t have a GPU available. Install it using the following commands:</p>
<pre><code>pip install tensorflow==2.5.0 # newer version should be also compatible
cd tensorpotential
pip install --upgrade .</code></pre>
<h2 data-number="1.3" id="installation-of-pyace"><span class="header-section-number">1.3</span> Installation of <code>pyace</code></h2>
<p>Finally, <code>pyace</code> could be installed with</p>
<pre><code>cd pyace
pip install --upgrade .</code></pre>
<hr />
<h1 data-number="2" id="quick-start"><span class="header-section-number">2</span> Quick start</h1>
<p>Running a fit with <code>pacemaker</code> requires at least two components: fitting dataset and configurational input file. Fitting dataset contains structural information as well as corresponding energies and forces that are subject to fitting with ACE. Input file contains details about desired ACE potential configuration and various parameters influencing optimization process.<br />
In this section we will describe the format of the fitting dataset, we will run a fit with an example dataset and overview the output produced by <code>pacemaker</code>. Input parameters are detailed in the <a href="#input-file-overview">section</a> below.</p>
<h2 data-number="2.1" id="fitting-dataset-preparation"><span class="header-section-number">2.1</span> Fitting dataset preparation</h2>
<p>In order to use your data for fitting with <code>pacemaker</code> one would need to provide it in the form of <code>pandas</code> DataFrame. An example DataFrame can be red as:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_pickle(<span class="st">&quot;../data/exmpl_df.pckl.gzip&quot;</span>, compression<span class="op">=</span><span class="st">&quot;gzip&quot;</span>, protocol<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
<p>And it contains the following entries:</p>
<table>
<colgroup>
<col style="width: 2%" />
<col style="width: 5%" />
<col style="width: 11%" />
<col style="width: 69%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: right;">energy</th>
<th style="text-align: left;">forces</th>
<th style="text-align: left;">ase_atoms</th>
<th style="text-align: right;">energy_corrected</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">-3.69679</td>
<td style="text-align: left;">[[0.0, 0.0, 0.0]]</td>
<td style="text-align: left;">Atoms(symbols=‘Al’, pbc=True, cell=[[0.0, 1.949947, 1.949947], [1.949947, 0.0, 1.949947], [1.949947, 1.949947, 0.0]])</td>
<td style="text-align: right;">-3.69679</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3.71569</td>
<td style="text-align: left;">[[0.0, 0.0, 0.0]]</td>
<td style="text-align: left;">Atoms(symbols=‘Al’, pbc=True, cell=[[0.0, 1.964285, 1.964285], [1.964285, 0.0, 1.964285], [1.964285, 1.964285, 0.0]])</td>
<td style="text-align: right;">-3.71569</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-3.72955</td>
<td style="text-align: left;">[[0.0, 0.0, 0.0]]</td>
<td style="text-align: left;">Atoms(symbols=‘Al’, pbc=True, cell=[[0.0, 1.978417, 1.978417], [1.978417, 0.0, 1.978417], [1.978417, 1.978417, 0.0]])</td>
<td style="text-align: right;">-3.72955</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">-3.7389</td>
<td style="text-align: left;">[[0.0, 0.0, 0.0]]</td>
<td style="text-align: left;">Atoms(symbols=‘Al’, pbc=True, cell=[[0.0, 1.99235, 1.99235], [1.99235, 0.0, 1.99235], [1.99235, 1.99235, 0.0]])</td>
<td style="text-align: right;">-3.7389</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">-3.74421</td>
<td style="text-align: left;">[[0.0, 0.0, 0.0]]</td>
<td style="text-align: left;">Atoms(symbols=‘Al’, pbc=True, cell=[[0.0, 2.006091, 2.006091], [2.006091, 0.0, 2.006091], [2.006091, 2.006091, 0.0]])</td>
<td style="text-align: right;">-3.74421</td>
</tr>
</tbody>
</table>
<p>​</p>
<ul>
<li>Columns have the following meaning:
<ul>
<li><code>ase_atoms</code>: is the instance of the <a href="https://wiki.fysik.dtu.dk/ase/">ASE</a> Atoms class. This is the main form of storing structural information that <code>pacemkaer</code> relies on. It must contain information about atomic positions, corresponding atom types, pbc and lattice vectors.</li>
<li><code>energy</code>: total energy of the corresponding <code>ase_atoms</code> structure (in eV).</li>
<li><code>forces</code>: corresponding atomic forces in the form of 2D array with dimensions [NumberOfAtoms, 3] (in eV/A).</li>
<li><code>energy_corrected</code>: total energy of a structure minus a reference energy.</li>
</ul>
Reference energy might be different depending on the dataset at hand. In general, one would prefer to reference <code>energy</code> against the free atom energies. In this case <code>energy_corrected</code> corresponds to the cohesive energy. If the free atom energies are not available, reference energy might be any constant shift or 0. In this example <code>energy</code> is already the cohesive energy.<br />
NOTE: regardless how <code>energy_corrected</code> is produced, <em>this is the energy that will be used for fitting</em>.</li>
</ul>
<p>One could create such DataFrame from raw data following this example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ase <span class="im">import</span> Atoms</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect raw data for the first structure</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Positions</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>pos1 <span class="op">=</span> [[<span class="fl">2.04748516</span>, <span class="fl">2.04748516</span>, <span class="fl">0.</span>        ],</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>        , <span class="fl">0.</span>        , <span class="fl">0.</span>        ],</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">2.04748516</span>, <span class="fl">0.</span>        , <span class="fl">1.44281847</span>],</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>        , <span class="fl">2.04748516</span>, <span class="fl">1.44475745</span>]]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrix of lattice vectors</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>lattice1 <span class="op">=</span> [[<span class="fl">4.09497</span> , <span class="fl">0.</span>      , <span class="fl">0.</span>      ],</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>      , <span class="fl">4.09497</span> , <span class="fl">0.</span>      ],</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>      , <span class="fl">0.</span>      , <span class="fl">2.887576</span>]]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Atomic symbols</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>symbls1 <span class="op">=</span> [<span class="st">&#39;Al&#39;</span>, <span class="st">&#39;Al&#39;</span>, <span class="st">&#39;Ni&#39;</span>, <span class="st">&#39;Ni&#39;</span>]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># energy</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>e1 <span class="op">=</span> <span class="op">-</span><span class="fl">21.07723361</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Forces</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>f1 <span class="op">=</span> [[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>],</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>     [<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>],</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>     [<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.00725587</span>],</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>     [<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="op">-</span><span class="fl">0.00725587</span>]]</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co"># create ASE atoms</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>at1 <span class="op">=</span> Atoms(symbols<span class="op">=</span>symbls1, positions<span class="op">=</span>pos1, cell<span class="op">=</span>lattice1, pbc<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Collect raw data for the second structure</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>pos2  <span class="op">=</span> [[<span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>]]</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>lattice2 <span class="op">=</span> [[<span class="fl">0.</span>      , <span class="fl">1.781758</span>, <span class="fl">1.781758</span>],</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">1.781758</span>, <span class="fl">0.</span>      , <span class="fl">1.781758</span>],</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">1.781758</span>, <span class="fl">1.781758</span>, <span class="fl">0.</span>      ]]</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>symbls2 <span class="op">=</span> [<span class="st">&#39;Ni&#39;</span>]</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>e2 <span class="op">=</span> <span class="op">-</span><span class="fl">5.45708644</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>f2 <span class="op">=</span> [[<span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>]]</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>at2 <span class="op">=</span> Atoms(symbols<span class="op">=</span>symbls2, positions<span class="op">=</span>pos2, cell<span class="op">=</span>lattice2, pbc<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># set reference energy to 0</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>reference_energy <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co"># collect all the data into a dictionary </span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {<span class="st">&#39;energy&#39;</span>: [e1, e2], </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;forces&#39;</span>: [f1, f2], </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;ase_atoms&#39;</span>: [at1, at2], </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;energy_corrected&#39;</span>: [e1 <span class="op">-</span> reference_energy, e2 <span class="op">-</span> reference_energy]}</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co"># create a DataFrame</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co"># and save it </span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>df.to_pickle(<span class="st">&#39;my_data.pckl.gzip&#39;</span>, compression<span class="op">=</span><span class="st">&#39;gzip&#39;</span>, protocol<span class="op">=</span><span class="dv">4</span>)</span></code></pre></div>
<p>The resulting dataframe can be used for fitting with <code>pacemaker</code>.</p>
<h2 data-number="2.2" id="creating-an-input-file"><span class="header-section-number">2.2</span> Creating an input file</h2>
<p>In order to fit an ACE potential to the data prepared following the previous section, one need to create a configurational file with relevant settings. <code>pacemaker</code> utilizes <code>.yaml</code> format for configurations. An input file template can be created by running <code>pacemaker --template</code> (or <code>pacemaker -t</code>). Doing so will produce an <code>input.yaml</code> file with the most general settings that can be adjusted for a particular task. Detailed overview of the input file parameters can be found in the <a href="#input-file-overview">section</a> below.<br />
In this example we will use template as it is, however one would need to provide a path to the example dataset <code>exmpl_df.pckl.gzip</code>. This can be done by changing <code>filename</code> parameter in the <code>data</code> section of the <code>input.yaml</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">data:</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">   filename: /path/to/the/pyace/data/exmpl_df.pckl.gzip</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
<h2 data-number="2.3" id="run-fitting"><span class="header-section-number">2.3</span> Run fitting</h2>
<p>Running a fit is as easy as executing the command:</p>
<pre><code>pacemaker input.yaml</code></pre>
<p>or to run the fitting process in the background:</p>
<pre><code>nohup pacemaker input.yaml &amp;</code></pre>
<p>For more <code>pacemaker</code> command options see the corresponding <a href="#pacemaker-commands">section</a>.</p>
<p>Default behavior of pacemaker is to utilize a GPU accelerated fitting of ACE using <code>tensorpotential</code>. However, GPU parallelization is not supported at the moment. Therefore, if your machine has a multi GPU setup one would need to select a single one before running <code>pacemaker</code>. This can be done by executing <code>export CUDA_VISIBLE_DEVICES=ind</code> in the shell replacing <code>ind</code> with the GPU index (i.g. 0, 1, …) or -1 to disable GPU usage.<br />
Note, that <code>tensorpotential</code> can be used without a GPU as well.</p>
<h2 data-number="2.4" id="analysis"><span class="header-section-number">2.4</span> Analysis</h2>
<p>During and after the fitting <code>pacemaker</code> produces several outputs, including:</p>
<ul>
<li><code>interim_potential_X.yaml</code>: current state of the potential at each iteration of <a href="#fitting-settings">fit cycle</a> (i.g. X=0, 1, …)</li>
<li><code>interim_potential_best_cycle.yaml</code>: best out of X interim potentials</li>
<li><code>log.txt</code>: log file containing all current information including summary of the optimization steps.</li>
<li><code>report</code>: folder containing figures displaying various error statistics and distributions.</li>
<li><code>output_potential.yaml</code>: final fitted potential.</li>
</ul>
<p>There are two main types of the information in the log file:</p>
<ul>
<li>optimization step log:</li>
</ul>
<pre class="text"><code>Iteration   #999  (1052 evals):     Loss: 0.000192 | RMSE Energy(low): 17.95 (16.79) meV/at | Forces(low): 7.89 (7.04) meV/A | Time/eval: 517.83 mcs/at</code></pre>
<p>where <code>Iteration</code> is the index of the optimization step performed by the <a href="#fitting-settings">optimizer</a> (number in parentheses shows the number of function evaluation calls done by optimizaer), <code>Loss</code> is the current value of the loss function, <code>RMSE Energy/Forces</code> is the current root mean-squared error for energy/forces wrt. training dataset (numbers in paretheses show corresponding values for the structures which energy is not greater than <code>e_min + 1 eV</code>, where <code>e_min</code> is the lowest energy in the training set). <code>Time/eval</code> shows the computational time spent on evaluating loss function and it’s gradient for the training dataset averaged across evaluations and divided by the number of atoms. This timing doesn’t include optimization step itself.</p>
<ul>
<li>fit statistics:</li>
</ul>
<pre class="text"><code>--------------------------------------------FIT STATS--------------------------------------------
Iteration:  #1000Loss:    Total:  1.9159e-04 (100%) 
                        Energy:  1.6074e-04 ( 84%) 
                        Force:  3.0859e-05 ( 16%) 
                            L1:  0.0000e+00 (  0%) 
                            L2:  0.0000e+00 (  0%) 
Number of params./funcs:    232/86                                   Avg. time:     526.93 mcs/at
-------------------------------------------------------------------------------------------------
            Energy/at, meV/at   Energy_low/at, meV/at      Force, meV/A        Force_low, meV/A   
    RMSE:          17.93                16.73                 7.86                    7.06
    MAE:           12.22                11.11                 5.31                    3.30
    MAX_AE:        53.19                38.30                35.19                   20.32
-------------------------------------------------------------------------------------------------
</code></pre>
<p>Every <a href="#backend-specification">display_step</a> the summary of fit statistics is printed out. It displays the total loss function value and contributions to it from energy, forces and other <a href="#fitting-settings">regularizations parameters</a>. In addition to RMSE, mean-absolute error (MAE) and maximum absolute error (MAX_AE) are also printed.</p>
<h2 data-number="2.5" id="using-fitted-potential"><span class="header-section-number">2.5</span> Using fitted potential</h2>
<p>Fitted potential can be used for calculations both within python/<a href="https://wiki.fysik.dtu.dk/ase/">ASE</a> as well as <a href="https://github.com/lammps/lammps">LAMMPS</a>.</p>
<h3 data-number="2.5.1" id="ase"><span class="header-section-number">2.5.1</span> ASE</h3>
<p>Python interface of the ACE potential is realized via <a href="https://wiki.fysik.dtu.dk/ase/">ASE</a> calculator:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ase <span class="im">import</span> Atoms</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyace <span class="im">import</span> PyACECalculator</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the example of the Atoms from the first section</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Positions</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>pos1 <span class="op">=</span> [[<span class="fl">2.04748516</span>, <span class="fl">2.04748516</span>, <span class="fl">0.</span>        ],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>        , <span class="fl">0.</span>        , <span class="fl">0.</span>        ],</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">2.04748516</span>, <span class="fl">0.</span>        , <span class="fl">1.44281847</span>],</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>        , <span class="fl">2.04748516</span>, <span class="fl">1.44475745</span>]]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Matrix of lattice vectors</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>lattice1 <span class="op">=</span> [[<span class="fl">4.09497</span> , <span class="fl">0.</span>      , <span class="fl">0.</span>      ],</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>      , <span class="fl">4.09497</span> , <span class="fl">0.</span>      ],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>       [<span class="fl">0.</span>      , <span class="fl">0.</span>      , <span class="fl">2.887576</span>]]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Atomic symbols</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>symbls1 <span class="op">=</span> [<span class="st">&#39;Al&#39;</span>, <span class="st">&#39;Al&#39;</span>, <span class="st">&#39;Ni&#39;</span>, <span class="st">&#39;Ni&#39;</span>]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># create ASE atoms</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>at1 <span class="op">=</span> Atoms(symbols<span class="op">=</span>symbls1, positions<span class="op">=</span>pos1, cell<span class="op">=</span>lattice1, pbc<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create calculator</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>calc <span class="op">=</span> PyACECalculator(<span class="st">&#39;output_potential.yaml&#39;</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Attach it to the Atmos</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>at1.set_calculator(calc)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate properties</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>energy <span class="op">=</span> at1.get_potential_energy()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>forces <span class="op">=</span> at1.get_forces()</span></code></pre></div>
<h3 data-number="2.5.2" id="lammps"><span class="header-section-number">2.5.2</span> LAMMPS</h3>
<p>Using potential with <a href="https://www.lammps.org/">LAMMPS</a> requires its <a href="#potential-conversion">conversion</a> into <strong>YACE</strong> format with command</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode asm"><code class="sourceCode fasm"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pace_yaml2yace output_potential<span class="op">.</span>yaml</span></code></pre></div>
<p>that will generate <code>output_potential.yace</code> file, which you could use in LAMMPS input file</p>
<pre><code>## in.lammps

pair_style  pace 
pair_coeff  * * output_potential.yace Al Ni</code></pre>
<h4 data-number="2.5.2.1" id="lammps-compilation"><span class="header-section-number">2.5.2.1</span> LAMMPS compilation:</h4>
<p>You could get the supported version of LAMMPS from <a href="https://github.com/lammps/lammps">GitHub repository</a></p>
<h5 data-number="2.5.2.1.1" id="build-with-make"><span class="header-section-number">2.5.2.1.1</span> Build with <code>make</code></h5>
<p>Follow LAMMPS installation instructions</p>
<ol type="1">
<li>Go to <code>lammps/src</code> folder</li>
<li>Compile the ML-PACE library by running <code>make lib-pace args="-b"</code></li>
<li>Include <code>ML-PACE</code> in the compilation by running <code>make yes-ml-pace</code></li>
<li>Compile lammps as usual, i.e. <code>make serial</code> or <code>make mpi</code>.</li>
</ol>
<h5 data-number="2.5.2.1.2" id="build-with-cmake"><span class="header-section-number">2.5.2.1.2</span> Build with <code>cmake</code></h5>
<ol type="1">
<li>Create build directory and go there with</li>
</ol>
<pre><code>cd lammps
mkdir build
cd build</code></pre>
<ol start="2" type="1">
<li>Configure the lammps build with</li>
</ol>
<pre><code>cmake -DCMAKE_BUILD_TYPE=Release -DPKG_ML-PACE=ON ../cmake </code></pre>
<p>or</p>
<pre><code>cmake -DCMAKE_BUILD_TYPE=Release -D BUILD_MPI=ON -DPKG_ML-PACE=ON ../cmake</code></pre>
<p>For more information see <a href="https://lammps.sandia.gov/doc/Build_cmake.html">here</a>.</p>
<ol start="3" type="1">
<li>Build LAMMPS using <code>cmake --build .</code> or <code>make</code></li>
</ol>
<hr />
<h1 data-number="3" id="pacemaker-workflow"><span class="header-section-number">3</span> <code>pacemaker</code> workflow</h1>
<figure>
<img src="Scheme_ext.png" alt="pacemaker workflow scheme" /><figcaption aria-hidden="true"><code>pacemaker</code> workflow scheme</figcaption>
</figure>
<p>The <code>pacemaker</code> workflow is described in the following and summarized in the figure above.</p>
<ul>
<li><code>pacemaker</code> starts by constructing the potential according to the user specified basis configuration (<span class="math inline"><em>ν</em></span>-order, <span class="math inline"><em>n</em><sub>max</sub></span>, <span class="math inline"><em>l</em><sub>max</sub></span>, etc.) or loads it from an available potential file. Then the B-basis functions are constructed, to this end generalized Clebsch-Gordan coefficients are set up for generating product basis functions that are invariant with respect to rotation and inversion.</li>
<li>Then <code>pacemaker</code> constructs the neighborlist for all structures in the dataframe. The neighborlist can be added to the reference dataframe for a fast restart of future parameterization runs.</li>
<li>Next the weights for each structure and atom as required by the loss function are set up. <code>pacemaker</code> provides different weighting schemes. The weights are then added to the reference dataframe. Weights may also be added directly to the reference dataframe, so that the user has full control over the weights for each structure and force.</li>
<li><code>pacemaker</code> splits the dataset for training and for testing.</li>
<li>The further specification of L<span class="math inline"><sub>1</sub></span>, L<span class="math inline"><sub>2</sub></span> and radial smoothness <span class="math inline"><em>w</em><sub>0</sub>, <em>w</em><sub>1</sub>, <em>w</em><sub>2</sub></span> regularization contributions and the relative weight <span class="math inline"><em>κ</em></span> of energy and force errors enables <code>pacemaker</code> to set up the loss function.</li>
<li>The hierarchical basis extension is setup as ladder fitting scheme if requested by the user.</li>
<li>The optimization of the loss function can be carried out with different optimizers and optimization strategies. For each optimization step <code>pacemaker</code> stores the current potential and computes error metrics for energies and forces. In addition, external Python code can be called to perform specific calculations for advanced on-the-fly validation.</li>
<li>If requested, optimization is repeated with intermediate randomization of the training parameter.</li>
<li>During and at the end of loss function optimization <code>pacemaker</code> provides outputs for assessing the quality and convergence of a parameterization.</li>
<li><code>pacemaker</code> stores (and loads) the ACE potentials in a transparent YAML file format.</li>
</ul>
<h1 data-number="4" id="input-file"><span class="header-section-number">4</span> Input file</h1>
<p>The required settings are provided by input YAML file. This file consists of several sections devoted to setting up particular settings of <code>pacemaker</code>. The sections are listed below.</p>
<h2 data-number="4.1" id="cutoff-and-optional-metadata"><span class="header-section-number">4.1</span> Cutoff and (optional) metadata</h2>
<ul>
<li>Global cutoff for the neighborlist constructor is setup as:</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cutoff</span><span class="kw">:</span><span class="at"> </span><span class="fl">10.0</span></span></code></pre></div>
<ul>
<li>Metadata (optional)</li>
</ul>
<p>This is arbitrary key (string)-value (string) pairs that would be added to the potential YAML file:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metadata</span><span class="kw">:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">info</span><span class="kw">:</span><span class="at"> some info</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">comment</span><span class="kw">:</span><span class="at"> some comment</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">purpose</span><span class="kw">:</span><span class="at"> some purpose</span></span></code></pre></div>
<p>Moreover, <code>starttime</code> and <code>user</code> fields would be added automatically</p>
<h2 data-number="4.2" id="dataset-specification-section"><span class="header-section-number">4.2</span> Dataset specification section</h2>
<p>This section is denoted by the key</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">  ...</span></span></code></pre></div>
<p>Fitting dataset could be queried automatically from <code>structdb</code> (if corresponding <code>structdborm</code> package is installed and connection to database is configured, see <code>structdb.ini</code> file in home folder). Alternatively, dataset could be saved into file as a pickled <code>pandas</code> dataframe with special names for <a href="#fitting-dataset-preparation">columns</a>.</p>
<p>Example:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span><span class="co"> # dataset specification section</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">  # data configuration section</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">element</span><span class="kw">:</span><span class="at"> Al</span><span class="co">                    # element name</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">calculator</span><span class="kw">:</span><span class="at"> FHI-aims/PBE/tight</span><span class="co"> # calculator type from `structdb` </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">    # ref_energy: -1.234           # single atom reference energy</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">                                   # if not specified, then it will be queried from database</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">  # seed: 42                       # random seed for shuffling the data  </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">  # query_limit: 1000              # limiting number of entries to query from `structdb`</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">                                   # ignored if reading from cache</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">  # cache_ref_df: True             # whether to store the queried or modified dataset into file, default - True</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">  # filename: some.pckl.gzip       # force to read reference pickled dataframe from given file</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">  # ignore_weights: False          # whether to ignore energy and force weighting columns in dataframe</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">  # datapath: ../data              # path to folder with cache files with pickled dataframes </span></span></code></pre></div>
<p>Alternatively, instead of <code>data::config</code> section, one can specify just the cache file with pickled dataframe as <code>data::filename</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filename</span><span class="kw">:</span><span class="at"> small_df_tf_atoms.pckl</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">datapath</span><span class="kw">:</span><span class="at"> ../tests/</span></span></code></pre></div>
<p><code>data:datapath</code> option, if not provided, could be replaced with <em>environment variable</em> <strong>PACEMAKERDATAPATH</strong></p>
<p>Example of creating the <strong>subselection of fitting dataframe</strong> and saving it is given in <code>notebooks/data_preprocess.ipynb</code></p>
<p>Example of generating <strong>custom energy/forces weights</strong> is given in <code>notebooks/data_custom_weights.ipynb</code></p>
<h3 data-number="4.2.1" id="querying-data"><span class="header-section-number">4.2.1</span> Querying data</h3>
<p>You can just query and preprocess data, without running potential fitting. Here is the minimalistic input YAML:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input.yaml file</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cutoff</span><span class="kw">:</span><span class="at"> </span><span class="fl">10.0</span><span class="co">  # use larger cutoff to have excess neighbour list</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span><span class="co"> # dataset specification section</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">config</span><span class="kw">:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">element</span><span class="kw">:</span><span class="at"> Al</span><span class="co">                    # element name</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">calculator</span><span class="kw">:</span><span class="at"> FHI-aims/PBE/tight</span><span class="co"> # calculator type from `structdb`</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">seed</span><span class="kw">:</span><span class="at"> </span><span class="dv">42</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">datapath</span><span class="kw">:</span><span class="at"> ../data</span><span class="co">                # path to the directory with cache files</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">  # query_limit: 100               # number of entries to query  </span></span></code></pre></div>
<h3 data-number="4.2.2" id="preparing-the-data-constructing-neighbor-list"><span class="header-section-number">4.2.2</span> Preparing the data / constructing neighbor list</h3>
<p>You can use existing <code>.pckl.gzip</code> dataset and generate all necessary columns for that, including neighbourlists Here is the minimalistic input YAML:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input.yaml file</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cutoff</span><span class="kw">:</span><span class="at"> </span><span class="fl">10.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filename</span><span class="kw">:</span><span class="at"> my_dataset.pckl.gzip</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">backend</span><span class="kw">:</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">evaluator</span><span class="kw">:</span><span class="at"> tensorpot</span><span class="co">  # pyace, tensorpot</span></span></code></pre></div>
<p>Then execute <code>pacemaker --prepare-data input.yaml</code> Generation of the <code>my_dataset.pckl.gzip</code> from, for example, <em>pyiron</em> is shown in <code>notebooks/convert-pyiron-to-pacemaker.ipynb</code></p>
<h3 data-number="4.2.3" id="test-set"><span class="header-section-number">4.2.3</span> Test set</h3>
<p>You could provide test set either as a fraction or certain number of samples from the train set (option <code>test_size</code>) or as a separate pckl.gzip file (option <code>test_filename</code>)</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test_filename</span><span class="kw">:</span><span class="at"> my_test_dataset.pckl.gzip</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">100</span><span class="co"> # would take 100 samples randomly from train/fit set</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">  # test_size: 0.1 #  if &lt;1 - would take given fraction of samples randomly from train/fit set</span></span></code></pre></div>
<h2 data-number="4.3" id="interatomic-potential-or-b-basis-configuration"><span class="header-section-number">4.3</span> Interatomic potential (or B-basis) configuration</h2>
<h3 data-number="4.3.1" id="basis-configuration"><span class="header-section-number">4.3.1</span> Basis configuration</h3>
<p>In order to specify the B-basis potential, you have to provide four main components (aka <strong>basis shape</strong>): <code>elements</code>, <code>embeddings</code> for each element, <code>bonds</code> for each possible pairs of elements and <code>functions</code> for each possible combination of elements (unary, binary, ternary, etc.) as follows:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">deltaSplineBins</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.001</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">elements</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">Al</span><span class="kw">,</span><span class="at"> Ni</span><span class="kw">]</span><span class="co">  # list of all element</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # Embeddings are specified for each individual elements,</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # all parameters could be distinct for different species</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">embeddings</span><span class="kw">:</span><span class="co"> ## possible keywords: ALL, UNARY, elements: Al, Ni</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">Al</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">npot</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;FinnisSinclairShiftedScaled&#39;</span><span class="kw">,</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">fs_parameters</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="fl">0.5</span><span class="kw">],</span><span class="co"> ## non-linear embedding function: 1*rho_1^1 + 1*rho_2^0.5</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ndensity</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">      # core repulsion parameters</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">rho_core_cut</span><span class="kw">:</span><span class="at"> </span><span class="dv">200000</span><span class="kw">,</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">drho_core_cut</span><span class="kw">:</span><span class="at"> </span><span class="dv">250</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">Ni</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">npot</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;FinnisSinclairShiftedScaled&#39;</span><span class="kw">,</span><span class="co"> ## linear embedding function: 1*rho_1^1</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">fs_parameters</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">],</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">ndensity</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="kw">,</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">      # core repulsion parameters</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">rho_core_cut</span><span class="kw">:</span><span class="at"> </span><span class="dv">3000</span><span class="kw">,</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">drho_core_cut</span><span class="kw">:</span><span class="at"> </span><span class="dv">150</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co">  ## Bonds are specified for each possible pairs of elements</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co">  ## One could use keywords: ALL (Al,Ni, AlNi, NiAl)</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bonds</span><span class="kw">:</span><span class="co"> ## possible keywords: ALL, UNARY, BINARY, elements pairs as AlAl, AlNi, NiAl, etc...  </span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ALL</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">radbase</span><span class="kw">:</span><span class="at"> ChebExpCos</span><span class="kw">,</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">radparameters</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">5.25</span><span class="kw">],</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co">        ## outer cutoff, applied in a range [rcut - dcut, rcut]</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">rcut</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span><span class="kw">,</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dcut</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.01</span><span class="kw">,</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co">        ## inner cutoff, applied in a range [r_in, r_in + delta_in]</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">r_in</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span><span class="kw">,</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">delta_in</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span><span class="kw">,</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="co">        ## core-repulsion parameters `prefactor` and `lambda` in</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="co">        ## prefactor*exp(-lambda*r^2)/r, &gt;0 only r&lt;r_in+delta_in</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">core-repulsion</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">0.0</span><span class="kw">,</span><span class="at"> </span><span class="fl">5.0</span><span class="kw">],</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="co">    ## BINARY overwrites ALL settings when they are repeated</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">BINARY</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">radbase</span><span class="kw">:</span><span class="at"> ChebPow</span><span class="kw">,</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">radparameters</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">6.25</span><span class="kw">],</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="co">        ## cutoff may vary for different bonds</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">rcut</span><span class="kw">:</span><span class="at"> </span><span class="fl">5.5</span><span class="kw">,</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">dcut</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.01</span><span class="kw">,</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="co">        ## inner cutoff, applied in a range [r_in, r_in + delta_in]</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">r_in</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span><span class="kw">,</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">delta_in</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span><span class="kw">,</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="co">        ## core-repulsion parameters `prefactor` and `lambda` in</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a><span class="co">        ## prefactor*exp(-lambda*r^2)/r, &gt;0 only r&lt;r_in+delta_in</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">core-repulsion</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">0.0</span><span class="kw">,</span><span class="at"> </span><span class="fl">5.0</span><span class="kw">],</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="co">  ## possible keywords: ALL, UNARY, BINARY, TERNARY, QUATERNARY, QUINARY,</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a><span class="co">  ##  element combinations as (Al,Al), (Al, Ni), (Al, Ni, Zn), etc...</span></span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">functions</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">UNARY</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">nradmax_by_orders</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">15</span><span class="kw">,</span><span class="at"> </span><span class="dv">3</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">],</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">lmax_by_orders</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">],</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="co">      # coefs_init: zero # initialization of functions coefficients: zero (default) or random</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">BINARY</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">nradmax_by_orders</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">15</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">],</span></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">lmax_by_orders</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">],</span></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="co">      # coefs_init: zero # initialization of functions coefficients: zero (default) or random</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span></code></pre></div>
<p>In sections <code>embeddings</code>, <code>bonds</code> and <code>functions</code> one could use keywords (ALL, UNARY, BINARY, TERNARY, QUATERNARY, QUINARY). The settings provided by more specific keyword will override those from less specific keyword, i.e. ALL &lt; UNARY &lt; BINARY &lt; (‘Al’,‘Ni’)</p>
<h3 data-number="4.3.2" id="upfitting"><span class="header-section-number">4.3.2</span> Upfitting</h3>
<p>If you want to continue the fitting of the existing potential from <code>potential.yaml</code> file, then specify</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span><span class="at"> potential yaml</span></span></code></pre></div>
<p>alternatively, one could use <code>pacemaker ... -p potential.yaml</code> option.</p>
<p>For specifying both initial and target potential from the file one could provide:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filename</span><span class="kw">:</span><span class="at"> potential.yaml</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">  ## in &quot;ladder&quot; fitting scheme, potential from with to start fit</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # initial_potential: initial_potential.yaml</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">  ## reset potential from potential.yaml, i.e. set radial coefficients to delta_nk and func coeffs=[0..]</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">  # reset: true </span></span></code></pre></div>
<p>or alternatively, one could use <code>pacemaker ... -p potential.yaml -ip initial_potential.yaml</code> options.</p>
<h2 data-number="4.4" id="fitting-settings"><span class="header-section-number">4.4</span> Fitting settings</h2>
<p>Example of <code>fit</code> section is:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit</span><span class="kw">:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">    ## LOSS FUNCTION OPTIONS ##</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">loss</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">      ## [0..1] or auto, relative force weight,</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">      ## kappa = 0 - energies-only fit,</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">      ## kappa = 1 - forces-only fit</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">      ## auto - determined from dataset based on variance of energies and forces</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">kappa</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">      ## L1-regularization coefficient</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">L1_coeffs</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">      ## L2-regularization coefficient</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">L2_coeffs</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">      ## w0 radial smoothness regularization coefficient</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">w0_rad</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">      ## w1 radial smoothness regularization coefficient</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">w1_rad</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="kw">,</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">      ## w2 radial smoothness regularization coefficient</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">w2_rad</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span><span class="at">  </span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">    ## DATA WEIGHTING OPTIONS ##</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">weighting</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">        ## weights for the structures energies/forces are associated according to the distance to E_min:</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">        ## convex hull ( energy: convex_hull) or minimal energy per atom (energy: cohesive)</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">type</span><span class="kw">:</span><span class="at"> EnergyBasedWeightingPolicy</span><span class="kw">,</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">        ## number of structures to randomly select from the initial dataset</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">nfit</span><span class="kw">:</span><span class="at"> </span><span class="dv">10000</span><span class="kw">,</span><span class="at">         </span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">        ## only the structures with energy up to E_min + DEup will be selected</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">DEup</span><span class="kw">:</span><span class="at"> </span><span class="fl">10.0</span><span class="kw">,</span><span class="co">  ## eV, upper energy range (E_min + DElow, E_min + DEup)        </span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co">        ## only the structures with maximal force on atom  up to DFup will be selected</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">DFup</span><span class="kw">:</span><span class="at"> </span><span class="fl">50.0</span><span class="kw">,</span><span class="co"> ## eV/A</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co">        ## lower energy range (E_min, E_min + DElow)</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">DElow</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span><span class="kw">,</span><span class="co">  ## eV</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co">        ## delta_E  shift for weights, see paper</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">DE</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span><span class="kw">,</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co">        ## delta_F  shift for weights, see paper</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">DF</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span><span class="kw">,</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co">        ## 0&lt;wlow&lt;1 or None: if provided, the renormalization weights of the structures on lower energy range (see DElow)</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">wlow</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.75</span><span class="kw">,</span><span class="at">        </span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co">        ##  &quot;convex_hull&quot; or &quot;cohesive&quot; : method to compute the E_min</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">energy</span><span class="kw">:</span><span class="at"> convex_hull</span><span class="kw">,</span><span class="at">        </span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="co">        ## structures types: all (default), bulk or cluster</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">reftype</span><span class="kw">:</span><span class="at"> all</span><span class="kw">,</span><span class="at">        </span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co">        ## random number seed</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">seed</span><span class="kw">:</span><span class="at"> </span><span class="dv">42</span><span class="at"> </span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="co">    ## Custom weights:  corresponding to main dataset index and `w_energy` and `w_forces` columns should</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="co">    ## be provided in pckl.gzip file</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="co">    #weighting: {type: ExternalWeightingPolicy, filename: custom_weights_only.pckl.gzip}</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="co">    ## OPTIMIZATION OPTIONS ##</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">optimizer</span><span class="kw">:</span><span class="at"> BFGS</span><span class="co"> # BFGS, L-BFGS-B, Nelder-Mead, etc. : scipy minimization algorithm</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="co">    ## additional options for scipy.minimize(..., options={...}, ...)</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="co">    #options: {maxcor: 100}    </span></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">maxiter</span><span class="kw">:</span><span class="at"> </span><span class="dv">1000</span><span class="co"> # maximum number of iteration for EACH scipy minimization round</span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a><span class="co">    ## EXTRA OPTIONS ##</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">repulsion</span><span class="kw">:</span><span class="at"> auto</span><span class="co">            # set inner cutoff based on the minimal distance in the dataset</span></span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a><span class="co">    #trainable_parameters: ALL  # ALL, UNARY, BINARY, ..., radial, func, {&quot;AlNi&quot;: &quot;func&quot;}, {&quot;AlNi&quot;: {&quot;func&quot;,&quot;radial&quot;}}, ...</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a><span class="co">    ##(optional) number of consequentive runs of fitting algorithm (for each ladder step), that helps convergence</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a><span class="co">    #fit_cycles: 1   </span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="co">    ## starting from second fit_cycle:</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="co">    ## applies Gaussian noise with specified relative sigma/mean ratio to all potential trainable coefficients</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="co">    #noise_relative_sigma: 1e-3</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a><span class="co">    ## applies Gaussian noise with specified absolute sigma to all potential trainable coefficients</span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a><span class="co">    #noise_absolute_sigma: 1e-3  </span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="co">    # reset the function coefficients according to Gaussian distribution with given sigma; enable ensemble fitting mode</span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a><span class="co">    #randomize_func_coeffs: 1e-3  </span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a><span class="co">    ## LADDER SCHEME (i.e. hierarchical fitting) ##      </span></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="co">    ## enables hierarchical fitting (LADDER SCHEME), that sequentially add specified number of B-functions (LADDER STEP)    </span></span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="co">    #ladder_step: [10, 0.02]  </span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="co">    ##      - integer &gt;= 1 - number of basis functions to add in ladder scheme,</span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a><span class="co">    ##      - float between 0 and 1 - relative ladder step size wrt. current basis step</span></span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a><span class="co">    ##      - list of both above values - select maximum between two possibilities on each iteration </span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a><span class="co">    ##     see. Ladder scheme fitting for more info</span></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a><span class="co">    ## Possible values:</span></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="co">    ## body_order  -  new basis functions are added according to the body-order, i.e., a function with higher body-order</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a><span class="co">    ##                will not be added until the list of functions of the previous body-order is exhausted</span></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a><span class="co">    ## power_order -  the order of adding new basis functions is defined by the &quot;power rank&quot; p of a function.</span></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a><span class="co">    ##                p = len(ns) + sum(ns) + sum(ls). Functions with the smallest p are added first      </span></span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a><span class="co">    #ladder_type: body_order    </span></span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a><span class="at">                                </span></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a><span class="co">    ## callbacks during the fitting. Module quick_validation.py should be available for import</span></span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a><span class="co">    ## see example/pacemaker_with_callback for more details and examples</span></span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a><span class="co">    #callbacks:</span></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a><span class="co">    #  - quick_validation.test_fcc_potential_callback</span></span></code></pre></div>
<p>If not specified, then <em>uniform weight</em> and <em>energy-only</em> fit (kappa=0), <em>fit_cycles</em>=1, <em>noise_relative_sigma</em> = 0 settings will be used.</p>
<p>If ladder fitting scheme is used, then intermediate version of the potential after each ladder step will be saved into <code>interim_potential_ladder_step_{LADDER_STEP}.yaml</code>.</p>
<h2 data-number="4.5" id="backend-specification"><span class="header-section-number">4.5</span> Backend specification</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">backend</span><span class="kw">:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">evaluator</span><span class="kw">:</span><span class="at"> tensorpot</span><span class="co">  # pyace, tensorpot</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">  ## for `tensorpot` evaluator, following options are available:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">  # batch_size: 10            # batch size for loss function evaluation, default is 10</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">  # batch_size_reduction: True # automatic batch_size reduction if not enough memory (default - True) </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">  # batch_size_reduction_factor: 1.618  # batch size reduction factor</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">  # display_step: 20          # frequency of detailed metric calculation and printing</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">  ## for `pyace` evaluator, following options are available:</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">  # parallel_mode: process    # process, serial  - parallelization mode for `pyace` evaluator</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">  # n_workers: 4              # number of parallel workers for `process` parallelization mode</span></span></code></pre></div>
<p>Alternatively, backend could be selected as <code>pacemaker ... -b tensorpot</code></p>
<h2 data-number="4.6" id="ladder-hiererchical-basis-extension"><span class="header-section-number">4.6</span> Ladder (hiererchical) basis extension</h2>
<p>In a ladder scheme potential extension happens by adding new portion of basis functions step-by-step, to form a “ladder” from <em>initial potential</em> to <em>final potential</em>. Following settings should be added to the input YAML file:</p>
<ul>
<li>Specify <em>final potential</em> shape by providing <code>potential</code> section:</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">deltaSplineBins</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.001</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">element</span><span class="kw">:</span><span class="at"> Al</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="at">  ...</span></span></code></pre></div>
<ul>
<li>Specify <em>initial potential</em> by providing <code>initial_potential</code> option in <code>potential</code> section:</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="at">    ...</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">initial_potential</span><span class="kw">:</span><span class="at"> some_start_or_interim_potential.yaml</span><span class="co">    # potential to start fit from</span></span></code></pre></div>
<p>If <em>initial potential</em> is not specified, then the fit will start from empty potential. Alternatively, you can specify <em>initial potential</em> by command-line option</p>
<p><code>pacemaker ... -ip some_start_or_interim_potential.yaml</code></p>
<ul>
<li>Specify <code>ladder_step</code> in <code>fit</code> section:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit</span><span class="kw">:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="at">    ...</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ladder_step</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">10</span><span class="kw">,</span><span class="at"> </span><span class="fl">0.02</span><span class="kw">]</span><span class="at">       </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Possible values:</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">##  - integer &gt;= 1 - number of basis functions to add in ladder scheme,</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">##  - float between 0 and 1 - relative ladder step size wrt. current basis step</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">##  - list of both above values - select maximum between two possibilities on each iteration  </span></span></code></pre></div>
<p>See <code>example/ladder_fit_pyace.yaml</code> and <code>example/ladder_fit_tensorpot.yaml</code> example input files</p>
<h1 data-number="5" id="pacemaker-command-line-interface"><span class="header-section-number">5</span> <code>pacemaker</code> command line interface</h1>
<p><code>pacemaker</code> is an utility for fitting the atomic cluster expansion potential. Usage:</p>
<pre><code>usage: pacemaker [-h] [-c] [-o OUTPUT] [-p POTENTIAL] [-ip INITIAL_POTENTIAL]
                 [-b BACKEND] [-d DATA] [--query-data] [--prepare-data]
                 [--rebuild] [-l LOG] [-dr] [-t]
                 [input]

Fitting utility for atomic cluster expansion potentials

positional arguments:
  input                 input YAML file, default: input.yaml

optional arguments:
  -h, --help            show this help message and exit
  -c, --clean           Remove all generated data
  -o OUTPUT, --output OUTPUT
                        output B-basis YAML file name, default:
                        output_potential.yaml
  -p POTENTIAL, --potential POTENTIAL
                        input potential YAML file name, will override input
                        file &#39;potential&#39; section
  -ip INITIAL_POTENTIAL, --initial-potential INITIAL_POTENTIAL
                        initial potential YAML file name, will override input
                        file &#39;potential::initial_potential&#39; section
  -b BACKEND, --backend BACKEND
                        backend evaluator, will override section
                        &#39;backend::evaluator&#39; from input file
  -d DATA, --data DATA  data file, will override section &#39;YAML:fit:filename&#39;
                        from input file
  --query-data          query the training data from database, prepare and
                        save them
  --prepare-data        prepare and save training data only
  --rebuild             force to rebuild necessary neighbour lists
  -l LOG, --log LOG     log filename, default: log.txt
  -dr, --dry-run        Dry run: performs all preprocessing and analysis, but
                        do not do the fitting
  -t, --template        Create a template &#39;input.yaml&#39; file
  -v, --version         Show version info
  --no-fit              Do not fit the potential
  --no-predict          Do not compute and save the predictions
  --verbose-tf          Make tensorflow more verbose (off by defeault)
</code></pre>
<h1 data-number="6" id="utilities"><span class="header-section-number">6</span> Utilities</h1>
<h2 data-number="6.1" id="potential-conversion"><span class="header-section-number">6.1</span> Potential conversion</h2>
<p>There are <strong>two</strong> basic formats for ACE potentials:</p>
<ol type="1">
<li><strong>B-basis set</strong> - YAML format, i.e. ‘Al.pbe.yaml’. This is an internal <em>complete</em> format for potential fitting.</li>
<li><strong>Ctilde-basis set</strong> - YACE (special form of YAML) format, i.e. ‘Al.pbe.yace’. This format is <em>irreversibly</em> converted from <em>B-basis set</em> for public potentials distribution and for using in LAMMPS simulations.</li>
</ol>
<p>Please see [pacemaker paper] for more details about <strong>B-basis</strong> and <strong>Ctilde-basis sets</strong></p>
<p>To convert potential you can use following utility, that is installed together with <code>pyace</code> package into you executable paths: * <code>YAML</code> to <code>yace</code> : <code>pace_yaml2yace</code>. Usage:</p>
<pre><code>  usage: pace_yaml2yace [-h] [-o OUTPUT] input [input ...]

Conversion utility from B-basis (.yaml file) to new-style Ctilde-basis (.yace
file)

positional arguments:
  input                 input B-basis file name (.yaml)

optional arguments:
  -h, --help            show this help message and exit
  -o OUTPUT, --output OUTPUT
                        output Ctilde-basis file name (.yace)
</code></pre>
<h2 data-number="6.2" id="yaml-potential-timing"><span class="header-section-number">6.2</span> YAML potential timing</h2>
<p>Utility to run the single-CPU timing test for PACE (.yaml) potential. Usage:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>pace_timing [-h] potential_file</span></code></pre></div>
<h2 data-number="6.3" id="yaml-potential-info"><span class="header-section-number">6.3</span> YAML potential info</h2>
<p>Utility to show the basic information (type of embedding, cutoff, radial functions, n-max, l-max etc.) for PACE (.yaml) potential. Usage:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pace_info [-h] potential_file</span></code></pre></div>
<hr />
<h1 data-number="7" id="frequently-asked-questions-faq"><span class="header-section-number">7</span> Frequently asked questions (FAQ)</h1>
<h2 data-number="7.1" id="what-is-a-good-value-for-batch_size"><span class="header-section-number">7.1</span> What is a good value for batch_size?</h2>
<p>In order to achieve better fitting performance large <em>batch_size</em> (i.e. 100 or 1000) is recommended. If <code>batch_size_reduction=True</code> (default option), then automatic batch size reduction will happen and you could start from initial large <em>batch_size</em> value.</p>
<h2 data-number="7.2" id="my-fit-on-gpu-crushes-with-oom-error-what-to-do"><span class="header-section-number">7.2</span> My fit on GPU crushes with OOM error, what to do ?</h2>
<p>This means that you are trying to fit at once too much data into the GPU memory. The amount of data processed by GPU at once is controlled by <a href="#backend-specification">batch_size</a> parameter, try to reduce it or set <code>batch_size_reduction=True</code>. An optimal value for this parameter is totally empirical as it depends on data, potential configuration and GPU itself.</p>
<h2 data-number="7.3" id="can-i-toggle-between-cpu-and-gpu-when-starting-pacemaker"><span class="header-section-number">7.3</span> Can I toggle between CPU and GPU when starting pacemaker?</h2>
<p>If you have GPU configured on your machine it will be used by default. You can have additional control over GPU configuration via <code>input.yaml::backend::gpu_config</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">backend</span><span class="kw">:</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">gpu_config</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="fu">gpu_ind</span><span class="kw">:</span><span class="at"> &lt;int&gt;</span><span class="kw">,</span><span class="at"> </span><span class="fu">mem_limit</span><span class="kw">:</span><span class="at"> &lt;int&gt;</span><span class="kw">}</span></span></code></pre></div>
<ul>
<li><code>gpu_ind</code>: index of the GPU you want to use for fitting. This need to be specified in case your machine has multiple GPUs (multi GPU fitting is not supported at the moment). Set this parameter to -1 to disable GPU utilization. Default is 0.</li>
<li><code>mem_limit</code>: maximum amount of GPU memory in MB that is allowed to be used by fitting process. Default is 0 which allows to consume the whole available memory.<br />
NOTE: memory reserved by the fitting process is not available to anything else. Therefore, it’s recommended to set this restriction if you also use the same machine for processes requiring GUI.</li>
</ul>
<h2 data-number="7.4" id="i-dont-have-a-gpu.-should-i-use-backend-evaluator-tensorpotential-or-pyace"><span class="header-section-number">7.4</span> I dont have a GPU. Should I use backend, evaluator= <code>tensorpotential</code> or <code>pyace</code>?</h2>
<p>It is recommended to use <code>tensorpotential</code> evaluator for fitting anyways. Even without GPU acceleration non-linear optimization greatly benefits from autogradients provided by TensorFlow.</p>
<h2 data-number="7.5" id="how-to-continue-fitting"><span class="header-section-number">7.5</span> How to continue fitting ?</h2>
<p>Fitting an ACE potential can be continued or restarted from any <code>.yaml</code> potential file produced previously.<br />
If you want to continue fit without changing the basis size, you can do the following: - Provide the path to the starting potential in corresponding field in the <code>input.yaml</code> file <code>yaml     potential: /path/to/your/potential.yaml</code> - or provide this path through the command line interface <code>text     pacemaker input.yaml -p /path/to/your/potential.yaml</code> doing this will override specifications in the <code>input.yaml</code>.</p>
<p>If you want to extend the basis (aka do the <a href="#ladder-scheme-fitting">ladder scheme fitting</a>): - Specify your potential as initial potential <code>yaml     potential:            ...            initial_potential: /path/to/your/potential.yaml            ...</code> - or use the CLI: <code>text     pacemaker input.yaml -ip /path/to/your/potential.yaml</code></p>
<h2 data-number="7.6" id="i-want-to-preserve-the-shape-of-potential-but-refit-it-from-scratch"><span class="header-section-number">7.6</span> I want to preserve the “shape” of potential, but refit it from scratch</h2>
<div class="sourceCode" id="cb39"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#input.yaml</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filename</span><span class="kw">:</span><span class="at"> /path/to/your/potential.yaml</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">reset</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<p>It will reset potential from potential.yaml, i.e. set radial coefficients to delta_nk and B-basis function coefficients to zero.</p>
<h2 data-number="7.7" id="my-potential-behaves-unphysical-at-short-distances-how-to-fix-it"><span class="header-section-number">7.7</span> My potential behaves unphysical at short distances, how to fix it?</h2>
<p>If training data lacks data at shorter distances, expected repulsive behaviour is not always reproduced. In order to avoid it, you should use core-repulsion potential when you define the potential in <code>input.yaml</code> which replaces ACE potential with an exponential repulsion:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">## input.yaml</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">embeddings</span><span class="kw">:</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ALL</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="at">      ...</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">      # core repulsion parameters</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">rho_core_cut</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span><span class="kw">,</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">drho_core_cut</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="at">      ...</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bonds</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ALL</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">      ## inner cutoff, applied in a range [r_in - delta_in, r_in]</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">r_in</span><span class="kw">:</span><span class="at"> </span><span class="fl">2.3</span><span class="kw">,</span><span class="co"> # distance, below which the core repulsion start</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">delta_in</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span><span class="kw">,</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co">      ## core-repulsion parameters `prefactor` and `lambda` in</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">      ## prefactor*exp(-lambda*r^2)/r, &gt;0 only r&lt;r_in+delta_in</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">core-repulsion</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">1e3</span><span class="kw">,</span><span class="at"> </span><span class="fl">1.0</span><span class="kw">],</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span></code></pre></div>
<p>If you did not specify it before the fit, you still could add it after with Python API:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyace <span class="im">import</span> <span class="op">*</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>bbasisconf <span class="op">=</span> BBasisConfiguration(<span class="st">&quot;original_potential.yaml&quot;</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> block <span class="kw">in</span> bbasisconf.funcspecs_blocks:</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    block.r_in <span class="op">=</span> <span class="fl">2.3</span> <span class="co"># minimal interatomic distance in dataset</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    block.delta_in <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    block.core_rep_parameters<span class="op">=</span>[<span class="fl">1e3</span>, <span class="fl">1.0</span>]</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    block.rho_cut <span class="op">=</span> block.drho_cut <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>bbasisconf.save(<span class="st">&quot;tuned_potential.yaml&quot;</span>)</span></code></pre></div>
<p>or by manually changing corresponding parameters in <code>original_potential.yaml</code> file.</p>
<p><strong>NOTE</strong> However, it is strongly recommended to add more data, that describe the behaviour ar short distances rather than relying on the core repulsion completely.</p>
<h2 data-number="7.8" id="how-to-split-traintest-data-for-the-fitting"><span class="header-section-number">7.8</span> How to split train/test data for the fitting?</h2>
<p>Just use <code>test_size</code> keyword in <code>input.yaml::data</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test_size</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span><span class="co"> # for 10% of data used for testing</span></span></code></pre></div>
<p>Alternatively, you can provide train and test datasets separately:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span><span class="kw">:</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">filename</span><span class="kw">:</span><span class="at"> /path/to/train_data.pckl.gzip    </span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">test_filename</span><span class="kw">:</span><span class="at"> /path/to/test_data.pckl.gzip </span></span></code></pre></div>
<h2 data-number="7.9" id="i-want-to-change-the-cutoff-what-should-i-do"><span class="header-section-number">7.9</span> I want to change the cutoff, what should I do ?</h2>
<p>If you decrease the cutoff, i.e. from <code>rcut: 7</code> to <code>rcut: 6.5</code>, then no neighbours will be lost, and you could continue to use the dataset, but it would be less computational efficient.</p>
<p>If you increase the cutoff, then it is necessary to rebuild the neighbour lists by adding <code>--rebuild</code> option to pacemaker, i.e.</p>
<blockquote>
<p>pacemaker … –rebuild</p>
</blockquote>
<h2 data-number="7.10" id="how-better-to-organize-my-dataset-files"><span class="header-section-number">7.10</span> How better to organize my dataset files ?</h2>
<p>It is recommended to store all dataset files (i.e. <code>df*.pckl.gzip</code>) in one folder and specify the environment variable <code>$PACEMAKERDATAPATH</code> (exectue it in terminal or add to for example <code>.bashrc</code>)</p>
<blockquote>
<p>export PACEMAKERDATAPATH=/path/to/my/datases/files</p>
</blockquote>
<h2 data-number="7.11" id="what-are-good-values-for-regularization-parameters"><span class="header-section-number">7.11</span> What are good values for regularization parameters ?</h2>
<p>Ideally, one would prefer avoid using regularizations and would use additional data instead. When this is not possible, it is recommended that relative contribution of the regularization terms into the total loss do not exceed a few percents. So, regularization parameters of order <strong>1e-5 ~ 1e-8</strong> are good initial values, but check their relative contribution in detailed statistics, printed every <code>input.yaml::backed::display_step</code> step.</p>
<h2 data-number="7.12" id="how-to-fit-only-certain-part-of-the-potential-i.e.-binary-interaction-only"><span class="header-section-number">7.12</span> How to fit only certain part of the potential, i.e. binary interaction only ?</h2>
<p>If you have already fitted potential <code>Al.yaml</code> and <code>Ni.yaml</code> and would like to create a binary potential by fitting to binary data, i.e. AlNi structures, then in <code>input.yaml::potential</code> you could provide only binary interaction parts:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">potential</span><span class="kw">:</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">deltaSplineBins</span><span class="kw">:</span><span class="at"> 0.001,</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">elements</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">Al</span><span class="kw">,</span><span class="at"> Ni</span><span class="kw">]</span><span class="at">,</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bonds</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">BINARY</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">rcut&#39;</span><span class="kw">:</span><span class="at"> </span><span class="fl">6.2</span><span class="kw">,</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">dcut&#39;</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.01</span><span class="kw">,</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">core-repulsion&#39;</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">0.0</span><span class="kw">,</span><span class="at"> </span><span class="fl">5.0</span><span class="kw">],</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">radbase&#39;</span><span class="kw">:</span><span class="at"> ChebExpCos</span><span class="kw">,</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="at">            </span><span class="fu">radparameters&#39;</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="fl">5.25</span><span class="kw">]</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">}</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">}</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">functions</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">BINARY</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">nradmax_by_orders</span><span class="kw">:</span><span class="at">  </span><span class="kw">[</span><span class="dv">5</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">],</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">lmax_by_orders</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">0</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">2</span><span class="kw">,</span><span class="at"> </span><span class="dv">1</span><span class="kw">],</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="kw">}</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">}</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co">  ## provide list of initial potentials</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">initial_potential</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">Al.yaml</span><span class="kw">,</span><span class="at"> Ni.yaml</span><span class="kw">]</span></span></code></pre></div>
<p>and in <code>input.yaml::fit</code> you add</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit</span><span class="kw">:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="at">  ...</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">trainable_parameters</span><span class="kw">:</span><span class="at"> BINARY</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="at">  ...</span></span></code></pre></div>
<h2 data-number="7.13" id="i-see-different-metrics-text-files-during-the-fit-what-is-it"><span class="header-section-number">7.13</span> I see different metrics text files during the fit, what is it ?</h2>
<p>All metrics files contain values of loss function (<em>loss</em>), its energy/forces contributions (<em>e_loss_contrib</em>, <em>f_loss_contrib</em>), regularization contributions (<em>reg_loss</em>) and also root mean squared error (RMSE)/ mean absolute error (MAE) (*rmse_**, *mae_**) of energies (<em>rmse_epa</em>,<em>mae_epa</em>) and forces (norm of error vector <em>rmse_f</em> and per-component <em>mae_f_comp</em>) for whole dataset as well as for structures within 1eV/atom above minumum (*low_**).<br />
<code>metrics.txt</code> and <code>test_metrics.txt</code> are update every train/test step, whereas <code>ladder_metrics.txt</code>/<code>test_ladder_metrics.txt</code> are updated after each ladder step and <code>cycle_metrics.txt</code>/<code>test_cycle_metrics.txt</code> are updated after each cycle on ladder step.</p>
<h2 data-number="7.14" id="optimization-stops-too-early-due-to-too-small-updates-but-i-want-to-run-it-longer"><span class="header-section-number">7.14</span> Optimization stops too early due to too small updates, but I want to run it longer…</h2>
<p>You need to decrease certain tolerance parameters for corresponding minimization algorithm. For example, for <a href="https://docs.scipy.org/doc/scipy/reference/optimize.minimize-bfgs.html">BFGS</a>, there is <code>gtol: 1e-5</code> default parameter, that you could decrease in <code>input.yaml</code></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fit</span><span class="kw">:</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">options</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span><span class="fu">gtol</span><span class="kw">:</span><span class="at"> </span><span class="fl">5e-7</span><span class="kw">}</span></span></code></pre></div>
<h2 data-number="7.15" id="how-to-create-a-custom-weights-dataframe-for-externalweightingpolicy"><span class="header-section-number">7.15</span> How to create a custom weights dataframe for ExternalWeightingPolicy?</h2>
<h2 data-number="7.16" id="how-to-add-more-weights-to-certain-structures"><span class="header-section-number">7.16</span> How to add more weights to certain structures ?</h2>
<h2 data-number="7.17" id="how-to-run-on-the-fly-validation-of-the-potential"><span class="header-section-number">7.17</span> How to run on-the-fly validation of the potential ?</h2>
</body>
</html>
